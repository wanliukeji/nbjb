<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Cache-control" content="no-cache"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="format-detection" content="telephone=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-title" content="阿拉宁波网"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
  <meta name="keywords" content="宁波,北仑,镇海,阿拉宁波网,新北仑论坛,镇海论坛,宁波网,宁波论坛,房产,人才,二手,商城,团购,文学,博客,摄影,时尚,拼客"/>
  <meta name="description" content="CNNB.COM,阿拉宁波网旗下地方社区门户,提供和分享宁波论坛,北仑论坛,镇海论坛,社交,房产,人才,购物等生活,商务资讯互动平台. ,阿拉宁波网"/>
  <link rel="shortcut icon" href="/favicon.ico"/>
  <link rel="bookmark" href="/favicon.ico" type="image/x-icon"/>
  <base href="http://dev.bbs.cnnb.com/"/>
  <title>积分记录 - 阿拉宁波网 - 手机版</title>
  <link rel="stylesheet" href="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/css/base.css" type="text/css"
        media="all">
  <link id="duceapp_style" rel="stylesheet"
        href="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="http://dev.bbs.cnnb.com/data/duceapp/base/common.css?FKK" type="text/css" media="all">
  <link rel="stylesheet" href="source/plugin/duceapp_scorebuy/static/css/addfunds_mobile.css?FKK" type="text/css"
        media="all">
  <script src="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/js/jquery.min.js?FKK"
          type="text/javascript"></script>
  <script type="text/javascript">var STYLEID = '14', STATICURL = 'static/',
      IMGDIR = 'http://dev.bbs.cnnb.com/template/weixia_cms/weixia/src/', VERHASH = 'FKK', charset = 'utf-8',
      discuz_uid = '8', cookiepre = 'oYZ9_f4b9_', cookiedomain = '.dev.bbs.cnnb.com', cookiepath = '/',
      showusercard = '1', attackevasive = '0', disallowfloat = 'newthread', creditnotice = '1|威望|,2|财富|,7|甬钻|',
      defaultstyle = '',
      REPORTURL = 'aHR0cDovL2Rldi5iYnMuY25uYi5jb20vcGx1Z2luLnBocD9pZD1kdWNlYXBwX3Njb3JlYnV5OnRyYWRlbG9nJm1vYmlsZT0y',
      SITEURL = 'http://dev.bbs.cnnb.com/', JSPATH = 'data/cache/', DUCEAPP = {}, calendarform = {
          head: '日期时间设置',
          year: ['年', 2000, 2030],
          month: ['月', 1, 12],
          day: ['日', 1, 28],
          hour: ['时', 0, 23],
          minute: ['分', 0, 59]
      }, DUCEAPP_LANG = {confirms: '确定', cancel: '取消'}, DUCEAPP_BASE = 'duceapp_base';</script>
  <script src="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/js/common.js?FKK" type="text/javascript"
          charset="utf-8"></script>
  <style>
    html {
      background-color: #FFFFFF;
    }
  </style>
</head>
<body class="bg">
<div class="duceapp_body">
  <div id="duceapp_head">
    <div class="headfixed duceapp_head fff hc">
      <div class="head_z z"><a href="javascript:;" onclick="history.go(-1)"><i class="duceapp_font f22">&#xe95d;</i></a>
      </div>
      <div class="head_y y"><a href="home.php?mod=space&amp;uid=8&amp;do=profile&amp;mycenter=1&amp;mobile=2"><i
        class="duceapp_font f22">&#xe932;</i></a></div>
      <h2>积分记录</h2>
    </div>
  </div>
  <div class="tbbox tbscrl tbbox2">
    <div class="tabs" id="tabs">
      <div class="tab bi_d bga">
        <ul class="f15 tab8 ff9">
          <li>
            <a href="home.php?mod=spacecp&amp;ac=credit&amp;op=base&amp;mobile=2">我的</a>
          </li>
          <li class="bb_d f15 a">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:tradelog&amp;mobile=2">记录</a>
          </li>
          <li class="bb_d f15 ">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:addfunds&amp;mobile=2">充值</a>
          </li>
          <li class="bb_d f15">
            <a
              href="">订单</a>
          </li>
          <li class="bb_d f15 ">
            <a href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:cash&amp;mobile=2">提现</a>
          </li>
          <li class="bb_d f15 ">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:invoice&amp;mobile=2">发票</a>
          </li>
          <li class="bb_d f15">
            <a
              href="">兑换</a>
          </li>
        </ul>
      </div>
      <div class="tbb bi_d bgb rel">
        <ul class="f14 ffb cl">
          <li class="a"><a href="plugin.php?id=duceapp_scorebuy:tradelog&amp;mobile=1">积分收益</a>
          <li class="b">/</li>
          <li><a href="plugin.php?id=duceapp_scorebuy:tradelog&status=1&amp;mobile=2">系统奖励</a></li>
          <li class="b">/</li>
        </ul>
        <span onclick="$('#srchlogfm').show();$(document.body).scrollTop(0)" class="abs mg_r ffr f14"
              style="top:8px;right:0;"><i class="duceapp_font vm2">&#xe951;</i> 查询</span></div>
    </div>
  </div>
  <div id="srchlogfm" class="srchlogfm bga" style="margin-top: -1px;">
    <!--    <form method="post" action="plugin.php?id=duceapp_scorebuy:tradelog">-->
    <div id="cy_form">
      <div class="bform tform sjno">
        <ul class="with optinit in65">
          <li>
            <span class="ipp">积分</span>
            <div class="ipt">
              <select id="integral" class="ps"></select>
            </div>
          </li>
          <li>
            <span class="ipp">时间范围</span>
            <div class="ipt">
              <div class="ipt mg_n z" style="width:43%">
                <input type="text" name="starttime" id="startTime" value="" class="px calendar" caltype="date"
                       placeholder="开始时间">
              </div>
              <div class="ipt mg_n y" style="width:43%">
                <input type="text" name="endtime" id="endTime" value="" class="px calendar" caltype="date"
                       placeholder="结束时间">
              </div>
              <div class="ipt mg_n hc ff9">至</div>
            </div>
          </li>

          <li>
            <span class="ipp">收支</span>
            <div class="ipt">
              <select id="expenses" class="ps"></select>
            </div>
          </li>

          <li>
            <span class="ipp">操作</span>
            <div class="ipt">
              <select id="operation" class="ps"></select>
            </div>
          </li>

          <li class="pnfm">
            <div class="w cl">
              <div class="z">
                <button type="button" name="search" class="pn pnw" style="background:#BBB;"
                        onclick="$('#srchlogfm').hide()" value="true">取消
                </button>
              </div>
              <div class="y">
                <button type="button" name="search" class="pn bgt pnw" id="searchsubmit">查询</button>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="creditslog">
    <ul class="pagelazy" id="page-ul">
    </ul>
  </div>

</div>
<script src="source/plugin/duceapp_base/static/js/optinit.js?FKK" type="text/javascript" charset="utf-8"></script>
<div class="maskmenu" style="display:none;"></div>
</div>
<div id="mask" style="display:none;"></div>
<script type="text/javascript">
    //获取文档高度
    function getDocumentTop() {
        var scrollTop = 0, bodyScrollTop = 0, documentScrollTop = 0;
        if (document.body) {
            bodyScrollTop = document.body.scrollTop;
        }
        if (document.documentElement) {
            documentScrollTop = document.documentElement.scrollTop;
        }
        scrollTop = (bodyScrollTop - documentScrollTop > 0) ? bodyScrollTop : documentScrollTop;
        return scrollTop;
    }

    //可视窗口高度
    function getWindowHeight() {
        var windowHeight = 0;
        if (document.compatMode == "CSS1Compat") {
            windowHeight = document.documentElement.clientHeight;
        } else {
            windowHeight = document.body.clientHeight;
        }
        return windowHeight;
    }

    //滚动条高度
    function getScrollHeight() {
        var scrollHeight = 0, bodyScrollHeight = 0, documentScrollHeight = 0;
        if (document.body) {
            bodyScrollHeight = document.body.scrollHeight;
        }
        if (document.documentElement) {
            documentScrollHeight = document.documentElement.scrollHeight;
        }
        scrollHeight = (bodyScrollHeight - documentScrollHeight > 0) ? bodyScrollHeight : documentScrollHeight;
        return scrollHeight;
    }

    var finished = true;

    $(function () {
        init(); //初始化查询下拉框选项值
        var items = getItems(); //测试数据   可删除
        // var items = getInitData(); //后台请求数据 获取集合
        var pageSize = 5;  //初始化 当页显示总行数
        var totalPage = getItems().length; //请求数据总行数
        appendToHTML(items, pageSize);  //显示数据内容
        $(window).scroll(function () {  //页面滑动至底部更新数据
            if (finished && getScrollHeight() >= (getWindowHeight() + getDocumentTop()) && pageSize <= totalPage) {
                console.log('已滑至底部');
                finished = false;
                // 设置两秒请求后台
                setTimeout(function () {
                    finished = true;
                    pageSize += 5;  //每请求一次增加一页显示
                    appendToHTML(items, pageSize); //更新数据
                    return;
                }, 2000);
            }
            ;
        });

        //查询 数据 异步实时更新显示
        $('#searchsubmit').click(function () {
            // items = ajax_http();
            appendToHTML(items, 5);
        });

        //请求后台数据 仅用于积分记录查询 一下全部为字符串类型
        function ajax_http() {
            var initItems = [];
            var integral = $('#integral').val();
            var starttime = $('#startTime').val();
            var endtime = $('#endTime').val();
            var expenses = $('#expenses').val();
            var operation = $('#operation').val();
            console.log('积分:' + integral + '\t 数据类型:' + typeof integral);
            console.log('开始时间:' + starttime + '\t 数据类型:' + typeof starttime);
            console.log('结束时间:' + endtime + '\t 数据类型:' + typeof endtime);
            console.log('收支:' + expenses + '\t 数据类型:' + typeof expenses);
            console.log('操作:' + operation + '\t 数据类型:' + typeof operation);
            //请求路径及筛选值
            $.ajax({
                //url: "http://localhost:8080/static/data/demo.json?integral="+integral + "&starttime="+starttime +
                // "&endtime="+endtime+"&expenses="+expenses+"&operation="+operation,
                dataType: "json",
                async: true,
                type: "GET", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    console.log(JSON.stringify(res));
                    var data_list = res.data;
                    if (res.status == 200) {
                        if (data_list != null && data_list != null && data_list != 'undefined') {
                            initItems = data_list;
                        }
                    } else {
                        console.dir(JSON.stringify(res));
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return initItems;
        };

        //初始化下拉动态选项值
        function init() {
            var $integral = $('#integral');
            var Integrals = getIntegrals();
            var $expenses = $('#expenses');
            var Expenses = getExpenses();
            var $operation = $('#operation');
            var Operations = getOperations();
            joinToSelect(Integrals, $integral);
            joinToSelect(Expenses, $expenses);
            joinToSelect(Operations, $operation);
        };

        //获取积分下拉集合
        function getIntegrals() {
            var Integrals = [
                {name: '不限', value: '0'},
                {name: '威望', value: '1'},
                {name: '财富', value: '1'},
                {name: '甬钻', value: '1'}
            ];

            $.ajax({
                //url: "http://localhost:8080/static/data/demo.json",  //请求路径
                dataType: "json",
                async: true,
                // data: {"company_name": company_name },
                type: "POST", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        if (data_list != null && data_list != null && data_list != 'undefined') {
                            Integrals = data_list;
                        }
                    } else {

                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return Integrals;
        };

        //获取收支下拉集合
        function getExpenses() {
            var expenses = [
                {name: '不限', value: '0'},
                {name: '支出', value: '1'},
                {name: '支入', value: '2'}
            ];

            $.ajax({
                //url: "http://localhost:8080/static/data/demo.json",  //请求路径
                dataType: "json",
                async: true,
                // data: {"company_name": company_name },
                type: "POST", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        if (data_list != null && data_list != null && data_list != 'undefined') {
                            expenses = data_list;
                        }
                    } else {

                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return expenses;
        };

        //获取操作下拉集合
        function getOperations() {
            var operations = [
                {name: '请选择操作类型', value: '0'},
                {name: '任务奖励', value: '1'},
                {name: '悬赏主题', value: '2'},
                {name: '最佳答案', value: '3'}
            ];

            $.ajax({
                //url: "http://localhost:8080/static/data/demo.json",  //请求路径
                type: "POST", //请求方式
                // data: {"company_name": company_name },
                dataType: "json",
                async: true,
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        if (data_list != null && data_list != null && data_list != 'undefined') {
                            operations = data_list;
                        }
                    } else {

                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return operations;
        };

        function joinToSelect(item, dom) {
            try {
                for (var i = 0; i < item.length; i++) {
                    var info = item[i];
                    dom.append('<option value="' + info.value + '">' + info.name + '</option>');
                }
            } catch (e) {
                console.log(e);
            }
        }

        //获取初始化总参数
        function getInitData() {
            return ajax_http();
        }

        //页面固定显示
        var li_html = '<li class = "bga bh_e f14"><a href = "#">' +
            '<div class = "cl"> <strong class = "status ffr" style = "float: left;">' + '</strong>' +
            ' <span class = "status"><em style = "color: #8b8b8b;" ></em></span></div><dl class = "cl" style="text-align: center; font-size: 14px; color: #a6a6a6;"><p>' +
            '暂无无更多交易记录' + '</p><dt></dt></dl><dl class = "cl mt6"><dd><span class = "status f13 ff9"></span>' + '</dd></dl></a></li>';

        //数据内容加工显示
        function appendToHTML(items, count) {
            if (items.length > 0 && items.length > count) {
                append_for(items, count);
                $('#page-ul').append('<li class = "bga bh_e f14"><a href = "">' +
                    '<div class = "cl"> <strong class = "status ffr" style = "float: left;"></strong>' +
                    ' <span class = "status"><em style = "color: #8b8b8b;"></em></span></div><dl class = "cl" style="text-align: center; font-size: 14px; color: #a6a6a6;"><p>' +
                    '往上滑动获取更多数据</p><dt></dt></dl><dl class = "cl mt6"><dd>' +
                    '<span class = "status f13 ff9"></span>' +
                    '</dd></dl></a></li>');
            } else if (count >= items.length) {
                append_for(items, count);
                $('#page-ul').append(li_html);
            } else {
                $('#page-ul').append(li_html);
            }

            function append_for(items, count) {
                $('#page-ul').html('');
                try {
                    for (var i = 0; i < count; i++) {
                        var info = items[i];
                        $('#page-ul').append('<li class = "bga bh_e f14"><a href = "">' +
                            '<div class = "cl"> <strong class = "status ffr" style = "float: left;">' + info.top_name + '</strong>' +
                            ' <span class = "status"><em style = "color: #8b8b8b;" >甬钻 - ' + info.number + ' </em></span></div><dl class = "cl"><p>' + info.remark + '</p><dt></dt></dl><dl class = "cl mt6"><dd>' +
                            '<span class = "status f13 ff9">' + info.time + '</span>' +
                            '</dd></dl></a></li>');
                    }

                } catch (e) {
                    e.message;
                    console.log(e.message);
                }
            }
        }

        //测试数据 可删除
        function getItems() {
            var items = [];
            for (let i = 1; i <= 20; i++) {
                var param = {
                    top_name: '测试-' + i,
                    remark: '购买了' + i + '个道具',
                    time: new Date().getFullYear() + '-' + new Date().getMonth() + '-' + new Date().getDay(),
                    number: i * 10
                }
                items.push(param);
            }
            return items;
        }

    });
</script>
</body>
</html>

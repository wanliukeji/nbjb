<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Cache-control" content="no-cache"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="format-detection" content="telephone=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-title" content="阿拉宁波网"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
  <meta name="keywords" content="宁波,北仑,镇海,阿拉宁波网,新北仑论坛,镇海论坛,宁波网,宁波论坛,房产,人才,二手,商城,团购,文学,博客,摄影,时尚,拼客"/>
  <meta name="description" content="CNNB.COM,阿拉宁波网旗下地方社区门户,提供和分享宁波论坛,北仑论坛,镇海论坛,社交,房产,人才,购物等生活,商务资讯互动平台. ,阿拉宁波网"/>
  <link rel="shortcut icon" href="/favicon.ico"/>
  <link rel="bookmark" href="/favicon.ico" type="image/x-icon"/>
  <base href="http://dev.bbs.cnnb.com/"/>
  <title>积分记录 - 阿拉宁波网 - 手机版</title>
  <link rel="stylesheet" href="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/css/base.css" type="text/css"
        media="all">
  <link id="duceapp_style" rel="stylesheet"
        href="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="http://dev.bbs.cnnb.com/data/duceapp/base/common.css?FKK" type="text/css" media="all">
  <link rel="stylesheet" href="source/plugin/duceapp_scorebuy/static/css/addfunds_mobile.css?FKK" type="text/css"
        media="all">
  <link rel="stylesheet" href="http://dev.bbs.cnnb.com/template/weixia_cms_app/weixia/css/common.css" charset="UTF-8">
  <script src="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/js/jquery.min.js?FKK"
          type="text/javascript"></script>
  <script type="text/javascript">var STYLEID = '14', STATICURL = 'static/',
      IMGDIR = 'http://dev.bbs.cnnb.com/template/weixia_cms/weixia/src/', VERHASH = 'FKK', charset = 'utf-8',
      discuz_uid = '8', cookiepre = 'oYZ9_f4b9_', cookiedomain = '.dev.bbs.cnnb.com', cookiepath = '/',
      showusercard = '1', attackevasive = '0', disallowfloat = 'newthread', creditnotice = '1|威望|,2|财富|,7|甬钻|',
      defaultstyle = '',
      REPORTURL = 'aHR0cDovL2Rldi5iYnMuY25uYi5jb20vcGx1Z2luLnBocD9pZD1kdWNlYXBwX3Njb3JlYnV5OnRyYWRlbG9nJm1vYmlsZT0y',
      SITEURL = 'http://dev.bbs.cnnb.com/', JSPATH = 'data/cache/', DUCEAPP = {}, calendarform = {
          head: '日期时间设置',
          year: ['年', 2000, 2030],
          month: ['月', 1, 12],
          day: ['日', 1, 28],
          hour: ['时', 0, 23],
          minute: ['分', 0, 59]
      }, DUCEAPP_LANG = {confirms: '确定', cancel: '取消'}, DUCEAPP_BASE = 'duceapp_base';</script>
  <script src="http://dev.bbs.cnnb.com/source/plugin/duceapp_base/static/js/common.js?FKK" type="text/javascript"
          charset="utf-8"></script>
  <style>
    html {
      background-color: #FFFFFF;
    }

    .top-span {
      margin-top: 10px;
    }

    .form-hiden {
      max-height: 30px;
    }

    .tab-ul {
      width: 100%;
      position: fixed;
      left: 0;
      top: 48px;
      z-index: 48;
    }
  </style>
</head>
<body class="bg">
<div class="duceapp_body">
  <div id="duceapp_head">
    <div class="headfixed duceapp_head fff hc">
      <div class="head_z z"><a href="javascript:;" onclick="history.go(-1)">
        <svg t="1569026194395" class="icon top-span" viewBox="0 0 1024 1024" version="1.1"
             xmlns="http://www.w3.org/2000/svg" p-id="1725" width="22" height="22">
          <path
            d="M350.62 514.18l392.72-395.43a32 32 0 0 0-45.41-45.1L282.66 491.78a32 32 0 0 0 0.16 45.25l415.27 412.44a32 32 0 1 0 45.1-45.41z"
            p-id="1726" fill="#ffffff"></path>
        </svg>
      </a>
      </div>
      <div class="head_y y"><a href="home.php?mod=space&amp;uid=8&amp;do=profile&amp;mycenter=1&amp;mobile=2">
        <svg t="1569025982977" class="icon top-span" viewBox="0 0 1024 1024" version="1.1"
             xmlns="http://www.w3.org/2000/svg" p-id="3706" width="22" height="22">
          <path
            d="M707.950617 82.17284c-50.567901-50.567901-126.419753-82.17284-202.271605-82.17284-69.530864 0-139.061728 31.604938-195.950617 82.17284-50.567901 50.567901-75.851852 120.098765-75.851852 195.950617 0 94.814815 44.246914 170.666667 113.777778 227.555555-63.209877 25.283951-120.098765 56.888889-158.024691 94.814815-94.814815 94.814815-139.061728 221.234568-139.061729 379.259259 0 25.283951 25.283951 44.246914 44.246914 44.246914 18.962963 0 44.246914-12.641975 44.246913-37.925926 0-170.666667 63.209877-297.08642 183.308642-372.938272 94.814815-50.567901 189.62963-56.888889 189.62963-56.888888H530.962963c120.098765-37.925926 151.703704-69.530864 183.308642-101.135803 0-6.320988 6.320988-6.320988 6.320988-12.641975 44.246914-63.209877 56.888889-94.814815 56.888888-164.345679 6.320988-101.135802-31.604938-151.703704-69.530864-195.950617z m-18.962963 195.950617c0 50.567901-12.641975 94.814815-50.567901 132.740741-37.925926 37.925926-82.17284 56.888889-139.061728 56.888888-101.135802 0-189.62963-88.493827-189.62963-195.950617 0-107.45679 82.17284-195.950617 189.62963-195.950617 107.45679 6.320988 189.62963 94.814815 189.629629 202.271605zM802.765432 575.209877c-18.962963-12.641975-37.925926-6.320988-50.567901 12.641975-12.641975 18.962963-6.320988 37.925926 12.641975 44.246913 0 0 31.604938 18.962963 56.888889 69.530865 31.604938 50.567901 69.530864 139.061728 69.530864 284.444444 0 18.962963 18.962963 37.925926 37.925926 37.925926s37.925926-12.641975 37.925926-37.925926c0-316.049383-158.024691-404.54321-164.345679-410.864197z"
            p-id="3707" fill="#ffffff"></path>
        </svg>
      </a></div>
      <h2>积分记录</h2>
    </div>
  </div>
  <!-- 已修改模块 -->
  <div class="tbbox tbscrl tbbox2 form-hiden">
    <div class="tabs tbfxd tab-ul">
      <div class="tab bi_d bga">
        <ul class="f15 tab8 ff9">
          <li>
            <a href="home.php?mod=spacecp&amp;ac=credit&amp;op=base&amp;mobile=2">我的</a>
          </li>
          <li class="bb_d f15 a">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:tradelog&amp;mobile=2">记录</a>
          </li>
          <li class="bb_d f15 ">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:addfunds&amp;mobile=2">充值</a>
          </li>
          <li class="bb_d f15">
            <a
              href="">订单</a>
          </li>
          <li class="bb_d f15 ">
            <a href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:cash&amp;mobile=2">提现</a>
          </li>
          <li class="bb_d f15 ">
            <a
              href="home.php?mod=spacecp&amp;ac=plugin&amp;op=credit&amp;id=duceapp_scorebuy:invoice&amp;mobile=2">发票</a>
          </li>
          <li class="bb_d f15">
            <a
              href="">兑换</a>
          </li>
        </ul>
      </div>
      <div class="tbb bi_d bgb rel">
        <ul class="f14 ffb cl">
          <li class="a"><a href="plugin.php?id=duceapp_scorebuy:tradelog&amp;mobile=1">积分收益</a>
          <li class="b">/</li>
          <li><a href="plugin.php?id=duceapp_scorebuy:tradelog&status=1&amp;mobile=2">系统奖励</a></li>
          <li class="b">/</li>
        </ul>
        <span onclick="$('#srchlogfm').show();$(document.body).scrollTop(0)" class="abs mg_r ffr f14"
              style="top:8px;right:0;">
          <svg t="1569027895397" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
               p-id="2108" width="16" height="12"><path
            d="M1003.86 964.58L837.2 797.92c-0.18-0.18-0.43-0.23-0.61-0.41 74.29-83.46 119.86-193 119.86-313.29C956.44 223.83 744.61 12 484.22 12S12 223.83 12 484.22s211.83 472.22 472.22 472.22c120.27 0 229.83-45.57 313.29-119.86 0.17 0.18 0.23 0.43 0.41 0.61l166.67 166.67a27.77 27.77 0 0 0 39.28-39.28z m-519.64-63.69C254.47 900.89 67.56 714 67.56 484.22S254.47 67.56 484.22 67.56s416.67 186.9 416.67 416.67S714 900.89 484.22 900.89z"
            p-id="2109" fill="#00BB33"></path></svg>
          查询</span></div>
    </div>
  </div>

  <div id="srchlogfm" class="srchlogfm bga" style="margin-top: -1px;">
    <div class="bform tform sjno">
      <ul class="with optinit in65">
        <li>
          <span class="ipp">积分</span>
          <div class="ipt">
            <select id="integral" class="ps"></select>
          </div>
        </li>
        <li>
          <span class="ipp">时间范围</span>
          <div class="ipt">
            <div class="ipt mg_n z" style="width:43%">
              <input type="text" name="starttime" id="startTime" value="" class="px calendar" caltype="date"
                     placeholder="开始时间">
            </div>
            <div class="ipt mg_n y" style="width:43%">
              <input type="text" name="endtime" id="endTime" value="" class="px calendar" caltype="date"
                     placeholder="结束时间">
            </div>
            <div class="ipt mg_n hc ff9">至</div>
          </div>
        </li>

        <li>
          <span class="ipp">收支</span>
          <div class="ipt">
            <select id="expenses" class="ps"></select>
          </div>
        </li>

        <li>
          <span class="ipp">操作</span>
          <div class="ipt">
            <select id="operation" class="ps"></select>
          </div>
        </li>

        <li class="pnfm">
          <div class="w cl">
            <div class="z">
              <button type="button" name="search" class="pn pnw" style="background:#BBB;"
                      onclick="$('#srchlogfm').hide()" value="true">取消
              </button>
            </div>
            <div class="y">
              <button type="button" name="search" class="pn bgt pnw" id="searchsubmit">查询</button>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <!--    </div>-->
  </div>

  <div class="creditslog">
    <ul class="pagelazy" id="page-ul">
    </ul>
  </div>

</div>
<script src="source/plugin/duceapp_base/static/js/optinit.js?FKK" type="text/javascript" charset="utf-8"></script>
<div class="maskmenu" style="display:none;"></div>
</div>
<div id="mask" style="display:none;"></div>
<script type="text/javascript">
    //获取文档高度
    function getDocumentTop() {
        var scrollTop = 0, bodyScrollTop = 0, documentScrollTop = 0;
        if (document.body) {
            bodyScrollTop = document.body.scrollTop;
        }
        if (document.documentElement) {
            documentScrollTop = document.documentElement.scrollTop;
        }
        scrollTop = (bodyScrollTop - documentScrollTop > 0) ? bodyScrollTop : documentScrollTop;
        return scrollTop;
    }

    //可视窗口高度
    function getWindowHeight() {
        var windowHeight = 0;
        if (document.compatMode == "CSS1Compat") {
            windowHeight = document.documentElement.clientHeight;
        } else {
            windowHeight = document.body.clientHeight;
        }
        return windowHeight;
    }

    //滚动条高度
    function getScrollHeight() {
        var scrollHeight = 0, bodyScrollHeight = 0, documentScrollHeight = 0;
        if (document.body) {
            bodyScrollHeight = document.body.scrollHeight;
        }
        if (document.documentElement) {
            documentScrollHeight = document.documentElement.scrollHeight;
        }
        scrollHeight = (bodyScrollHeight - documentScrollHeight > 0) ? bodyScrollHeight : documentScrollHeight;
        return scrollHeight;
    }

    var finished = true;

    var items = []; //集合。

    var getDateUrl = ''; //请求后台数据路径

    var getIntegralsUrl = ''; //请求积分

    var getExpensesUrl = ''; //请求收支

    var getOperationsUrl = ''; //请求操作

    $(function () {
        init(); //初始化查询下拉框选项值
        items = getItems(); //测试数据   可删除
        // var items = getInitData(); //后台请求数据 获取集合
        var pageSize = 5;  //初始化 当页显示总行数
        var totalPage = 0; //总行数
        var current = 0; //起始页
        totalPage = getItems().length; //请求数据总行数 可删除
        appendToHTML(items, pageSize, current);  //显示数据内容
        $(window).scroll(function () {  //页面滑动至底部更新数据
            if (finished && getScrollHeight() >= (getWindowHeight() + getDocumentTop()) && pageSize <= totalPage) {
                console.log('已滑至底部');
                finished = false;
                // 设置两秒请求后台
                setTimeout(function () {
                    finished = true;
                    current = pageSize;
                    pageSize += 5;  //每请求一次增加一页显示
                    // ajax_http();
                    appendToHTML(items, pageSize, current); //更新数据
                    return;
                }, 1500);
            }
            ;
        });

        //查询 数据 异步实时更新显示
        $('#searchsubmit').click(function () {
            items = ajax_http();
            appendToHTML(items, 5);
        });

        //请求后台数据 仅用于积分记录查询 一下全部为字符串类型
        function ajax_http() {
            var integral = $('#integral').val();
            var starttime = $('#startTime').val();
            var endtime = $('#endTime').val();
            var expenses = $('#expenses').val();
            var operation = $('#operation').val();
            //请求路径及筛选值
            $.ajax({
                url: getDateUrl + "?integral = " + integral + "&starttime=" + starttime + "&endtime=" + endtime + "&expenses=" + expenses + "&operation=" + operation + "pageSize" + pageSize + "current" + current,
                dataType: "json",
                async: true,
                type: "GET", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        items = data_list;
                        if (items != null) {
                            totalPage = items.length;
                        }
                    } else {
                        console.dir(JSON.stringify(res));
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        };

        //初始化下拉动态选项值
        function init() {
            var $integral = $('#integral');
            var Integrals = getIntegrals();  //获取积分下拉
            var $expenses = $('#expenses');
            var Expenses = getExpenses();   //获取收支下拉
            var $operation = $('#operation');
            var Operations = getOperations();  //获取操作下拉
            joinToSelect(Integrals, $integral);  //动态添加
            joinToSelect(Expenses, $expenses);
            joinToSelect(Operations, $operation);
        };

        //获取积分下拉集合
        function getIntegrals() {
            var Integrals = [
                {name: '不限', value: '0'},
                {name: '威望', value: '1'},
                {name: '财富', value: '1'},
                {name: '甬钻', value: '1'}
            ];

            $.ajax({
                url: getIntegralsUrl,  //请求路径
                dataType: "json",
                async: true,
                type: "POST", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        Integrals = data_list;
                    } else {
                        console.log('获取数据失败');
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return Integrals;
        };

        //获取收支下拉集合
        function getExpenses() {
            var expenses = [
                {name: '不限', value: '0'},
                {name: '支出', value: '1'},
                {name: '支入', value: '2'}
            ];

            $.ajax({
                //url: getExpensesUrl,  //请求路径
                dataType: "json",
                async: true,
                type: "POST", //请求方式
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        expenses = data_list;
                    } else {
                        console.log('获取数据失败');
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return expenses;
        };

        //获取操作下拉集合
        function getOperations() {
            // 测试数据 可删除
            var operations = [
                {name: '请选择操作类型', value: '0'},
                {name: '任务奖励', value: '1'},
                {name: '悬赏主题', value: '2'},
                {name: '最佳答案', value: '3'}
            ];

            $.ajax({
                url: getOperationsUrl,  //请求路径
                type: "GET", //请求方式
                dataType: "json",
                async: true,
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    var data_list = res.data;
                    if (res.status == 200) {
                        operations = data_list;
                    } else {
                        console.log('数据获取失败');
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
            return operations;
        };

        function joinToSelect(item, dom) {
            try {
                for (var i = 0; i < item.length; i++) {
                    var info = item[i];
                    dom.append('<option value="' + info.value + '">' + info.name + '</option>');
                }
            } catch (e) {
                console.log(e);
            }
        }

        //页面固定显示
        var li_html = '<li class = "bga bh_e f14"><a href = "#">' +
            '<div class = "cl"> <strong class = "status ffr" style = "float: left;">' + '</strong>' +
            ' <span class = "status"><em style = "color: #8b8b8b;" ></em></span></div><dl class = "cl" style="text-align: center; font-size: 14px; color: #a6a6a6;"><p>' +
            '暂无无更多交易记录' + '</p><dt></dt></dl><dl class = "cl mt6"><dd><span class = "status f13 ff9"></span>' + '</dd></dl></a></li>';

        //数据内容加工显示
        function appendToHTML(items, pageSize, current) {
            if (items.length > 0 && items.length > pageSize) {
                append_for(items, pageSize, current);
            } else if (pageSize >= items.length) {
                append_for(items, pageSize, current);
            }

            function append_for(items, pageSize, current) {
                var z_style = 'style="color: red;"';
                var f_style = 'style="color: black;"';
                try {
                    for (var i = current; i < pageSize; i++) {
                        var info = items[i];
                        if (info.number > 0) {
                            $('#page-ul').append('<li class = "bga bh_e f14"><a href = "">' +
                                '<div class = "cl"> <strong class = "status ffr" style = "float: left;">' + info.top_name + '</strong>' +
                                ' <span class = "status"><em" >甬钻  <i ' + z_style + '> + ' + info.number + '</i> </em></span></div><dl class = "cl"><p>' + info.remark + '</p><dt></dt></dl><dl class = "cl mt6"><dd>' +
                                '<span class = "status f13 ff9">' + info.time + '</span>' +
                                '</dd></dl></a></li>');
                        } else {
                            $('#page-ul').append('<li class = "bga bh_e f14"><a href = "">' +
                                '<div class = "cl"> <strong class = "status ffr" style = "float: left;">' + info.top_name + '</strong>' +
                                ' <span class = "status"><em" >甬钻  <i ' + f_style + '> ' + info.number + ' </em></span></div><dl class = "cl"><p>' + info.remark + '</p><dt></dt></dl><dl class = "cl mt6"><dd>' +
                                '<span class = "status f13 ff9">' + info.time + '</span>' +
                                '</dd></dl></a></li>');
                        }
                    }
                } catch (e) {
                    console.log(e);
                }
            }
        }

        //测试数据 可删除
        function getItems() {
            var items = [];
            for (let i = 1; i <= 10; i++) {
                var param = {
                    top_name: '购买积分',
                    remark: '购买 涂鸦板 积分',
                    time: new Date().getFullYear() + '-' + new Date().getMonth() + '-' + new Date().getDay(),
                    number: i * 10
                }

                if (i % 2 == 0) {
                    var param = {
                        top_name: '购买道具',
                        remark: '购买 涂鸦板 道具',
                        time: new Date().getFullYear() + '-' + new Date().getMonth() + '-' + new Date().getDay(),
                        number: i * -10
                    }
                }
                items.push(param);
            }
            return items;
        }
    });
</script>
</body>
</html>
